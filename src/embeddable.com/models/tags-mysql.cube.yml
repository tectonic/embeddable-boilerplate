cubes:
  - name: tags_mysql
    title: "Tags (MySQL)"
    data_source: mysql
    sql: >
      SELECT
        tags.id,
        tags.tag,
        COALESCE(COUNT(taggables.tag_id), 0) as taggables_count
      FROM tags
        LEFT JOIN taggables ON taggables.tag_id = tags.id
          AND taggables.taggable_type IN (
            'AwardForce\\\\Modules\\\\Entries\\\\Models\\\\Entry',
            'AwardForce\\\\Modules\\\\GrantReports\\\\Models\\\\GrantReport',
            'AwardForce\\\\Modules\\\\Funding\\\\Data\\\\Allocation'
          )
      WHERE tags.account_id = '{ COMPILE_CONTEXT.securityContext.accountId }'
      GROUP BY tags.id, tags.tag

    dimensions:
      - name: id
        sql: id
        type: number
        primary_key: true

      - name: tag
        title: 'Tag'
        sql: tag
        type: string

      - name: taggables_count
        title: 'Taggables Count'
        sql: taggables_count
        type: number
