cubes:
  - name: payment_methods_mysql
    title: "Payment Methods (MySQL)"
    data_source: mysql
    sql: >
      SELECT
        payment_methods.id,
        payment_methods.season_id,
        translations.name,
        payment_methods.created_at
      FROM payment_methods
        INNER JOIN translations
          ON translations.id = payment_methods.translation_id
            AND translations.resource = 'PaymentMethod'
            AND translations.field = 'name'
            AND translations.language_id = '{ COMPILE_CONTEXT.securityContext.languageId }'
            AND translations.account_id = '{ COMPILE_CONTEXT.securityContext.accountId }'
      WHERE payment_methods.account_id = '{ COMPILE_CONTEXT.securityContext.accountId }'
        AND payment_methods.deleted_at is null

    dimensions:
      - name: id
        sql: id
        type: number
        primary_key: true

      - name: name
        type: string
        sql: name

      - name: created_at
        sql: created_at
        type: time

    measures:
      - name: count
        type: count
        title: '# of payment methods'
